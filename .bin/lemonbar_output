#!/bin/bash
. ~/.bin/lemonbar_config

battery() {
    BATTERY="$(awk "{print}" /sys/class/power_supply/BAT0/capacity)"
    BATTERY_ICON=" "
    if [[ $BATTERY -ge 90 ]];
    then
	BATTERY_ICON="\uf240"
    elif [[ "$BATTERY" -ge 70 ]];
    then
	BATTERY_ICON="\uf241"
    elif [[ "$BATTERY" -ge 30 ]];
    then
	BATTERY_ICON="\uf242"
    elif [[ "$BATTERY" -ge 10 ]];
    then
	BATTERY_ICON="\uf243"
    else
	BATTERY_ICON="\uf244"
    fi
    echo -e "$BATTERY_ICON  $BATTERY%"

    
}

clock() {
    CLOCK="$(date +"%R")"
    DATE="$(date +"%d/%m/%Y")"
    echo -e "\uf073 "$DATE"    \uf017" $CLOCK
}

wifi(){
    WIFI_SIGNAL="$(awk "NR==3 {print int((\$3/70)*100)}" /proc/net/wireless)"
    echo "%{A:WIFI:}\uf1eb%{A}  %{A:SSID:}"$WIFI_SIGNAL"%%{A}"
}

volume(){
    VOLUME="$(amixer get Master | awk -F'[]%[]' '/%/ {if ($5 == "off") {printf "%d\n",0} else {printf "%d\n", $2}}' |uniq)"
    VOLUMECOMMAND="VOL"
    if [ "$VOLUME" -eq 0 ]
    then
	VOLUMEBAR="%{A:SHUTUP:}\uf026%{A} ────────────────────"
    else
	VOLUMEBAR="%{A:SHUTUP:}\uf028%{A} "
	for i in {1..20} 
	do
	    if [ $((i*5)) -le "$VOLUME" ];
	    then
		VOLUMEBAR=$VOLUMEBAR"%{A:"$VOLUMECOMMAND" "$((i*5))":}━%{A}"
	    else
		VOLUMEBAR=$VOLUMEBAR"%{A:"$VOLUMECOMMAND" "$((i*5))":}─%{A}"
	    fi
	done
    fi
    echo "$VOLUMEBAR $VOLUME"
}


PADDING="  "

while true; do
    BAR_INPUT="%{B#11ffffff}$PADDING$(wifi)$PADDING%{B#00000000}      %{B#11ffffff}$PADDING$(volume)$PADDING%{B#00000000}%{r}%{B#11ffffff}$PADDING%{A:BATTERY:}$(battery)%{A}$PADDING%{B#00000000}      %{B#11ffffff}$PADDING$(clock)$PADDING%{B#00000000}"
    echo -e "$BAR_INPUT"
    sleep 1
done
